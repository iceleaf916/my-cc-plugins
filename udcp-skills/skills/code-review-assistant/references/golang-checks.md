# Golang ä»£ç å®¡æ ¸æ£€æŸ¥è§„åˆ™

## å®¡æ ¸æŽ’é™¤è§„åˆ™

### [GO-EX001] vendor ç›®å½•

- **æè¿°**: `vendor/` ç›®å½•åŠå…¶ä¸­çš„æ‰€æœ‰æ–‡ä»¶ä¸è¿›è¡Œä»£ç å®¡æ ¸
- **å¤„ç†æ–¹å¼**:
  - ä¸å®¡æ ¸ `vendor/` ç›®å½•ä¸‹çš„ä»»ä½•æ–‡ä»¶å†…å®¹
  - ä¸æç¤ºå…³äºŽ `vendor/` ç›®å½•å­˜å‚¨æ–¹å¼çš„æ”¹è¿›å»ºè®®ï¼ˆå¦‚æ˜¯å¦ä½¿ç”¨ go modulesï¼‰
  - ä¸å¯¹ vendor ç›®å½•çš„å˜æ›´ç”Ÿæˆä»»ä½•å®¡æ ¸æ„è§
- **ç¤ºä¾‹**:

```
ä»¥ä¸‹æ–‡ä»¶è·¯å¾„åº”è¢«è·³è¿‡å®¡æ ¸:
- vendor/github.com/...
- vendor/golang.org/...
- vendor/*.go
```

---

### [GO-EX002] å•å…ƒæµ‹è¯•æ–‡ä»¶

- **æè¿°**: å•å…ƒæµ‹è¯•æ–‡ä»¶ä¸è¿›è¡Œä»£ç å®¡æ ¸ï¼Œæµ‹è¯•ä»£ç æœ‰å…¶ç‰¹æ®Šçš„ç¼–å†™è§„èŒƒå’Œçµæ´»æ€§è¦æ±‚
- **å¤„ç†æ–¹å¼**:
  - ä¸å®¡æ ¸ä»¥ `_test.go` ç»“å°¾çš„æ–‡ä»¶å†…å®¹
  - ä¸å¯¹æµ‹è¯•æ–‡ä»¶ä¸­çš„ä»£ç é£Žæ ¼ã€å‘½åè§„èŒƒç­‰æå‡ºæ”¹è¿›å»ºè®®
  - ä¸æç¤ºæµ‹è¯•æ–‡ä»¶ä¸­çš„é­”æ³•æ•°å­—ã€æœªä½¿ç”¨å˜é‡ç­‰é—®é¢˜
- **ç¤ºä¾‹**:

```
ä»¥ä¸‹æ–‡ä»¶è·¯å¾„åº”è¢«è·³è¿‡å®¡æ ¸:
- app/api/store/terminal_encryption_detail_test.go
- app/api/store/suite_test.go
- **/*_test.go
```

---

## æ£€æŸ¥è§„åˆ™æŒ‰ä¸¥é‡ç¨‹åº¦åˆ†ç±»

---

## ðŸ”´ Must Fix (-2)

### [GO-MF001] é”™è¯¯å¤„ç†ç¼ºå¤±

- **æè¿°**: å‡½æ•°è¿”å›žé”™è¯¯ä½†æœªæ£€æŸ¥å¤„ç†
- **å½±å“**: å¯èƒ½å¯¼è‡´ç¨‹åºç»§ç»­æ‰§è¡Œé”™è¯¯çŠ¶æ€ï¼Œå¼•å‘ç©ºæŒ‡é’ˆå¼‚å¸¸æˆ–å…¶ä»–æœªé¢„æœŸè¡Œä¸º
- **æ£€æµ‹æ–¹å¼**:
  - æ£€æµ‹å‡½æ•°è°ƒç”¨è¿”å›ž `(T, error)` ä½†æœªå¤„ç† `err`
  - æ£€æµ‹ `err != nil` ä½†æœªåšä»»ä½•æ“ä½œ
- **ç¤ºä¾‹**:

```go
// Bad - é”™è¯¯æœªå¤„ç†
user, _ := db.GetUser(id)

// Bad - é”™è¯¯è¢«å¿½ç•¥
if err := someFunc(); err != nil {
    // ç©ºå¤„ç†
}

// Good
user, err := db.GetUser(id)
if err != nil {
    return fmt.Errorf("failed to get user: %w", err)
}
```

- **å»ºè®®ä¿®æ”¹**: æ·»åŠ é€‚å½“çš„é”™è¯¯å¤„ç†ï¼Œè®°å½•æ—¥å¿—æˆ–è¿”å›žé”™è¯¯

---

### [GO-MF002] SQL æ³¨å…¥é£Žé™©

- **æè¿°**: ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æŽ¥æž„å»º SQL æŸ¥è¯¢ï¼Œå­˜åœ¨æ³¨å…¥é£Žé™©
- **å½±å“**: æ¶æ„è¾“å…¥å¯èƒ½å¯¼è‡´æ•°æ®åº“è¢«æ”»å‡»
- **æ£€æµ‹æ–¹å¼**:
  - æ£€æµ‹ SQL å­—ç¬¦ä¸²æ‹¼æŽ¥
  - æ£€æµ‹ `fmt.Sprintf` æž„å»º SQL æŸ¥è¯¢
- **ç¤ºä¾‹**:

```go
// Bad - å­—ç¬¦ä¸²æ‹¼æŽ¥
query := "SELECT * FROM users WHERE id = " + userID

// Bad - fmt.Sprintf
query := fmt.Sprintf("SELECT * FROM users WHERE name = '%s'", name)

// Good - å‚æ•°åŒ–æŸ¥è¯¢
query := "SELECT * FROM users WHERE id = ?"
rows, err := db.Query(query, userID)
```

- **å»ºè®®ä¿®æ”¹**: ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢æˆ– ORM çš„å®‰å…¨æŸ¥è¯¢æ–¹æ³•

---

### [GO-MF003] å¹¶å‘å®‰å…¨é—®é¢˜ - ç«žæ€æ¡ä»¶

- **æè¿°**: å¤šä¸ª goroutine åŒæ—¶è®¿é—®å…±äº«å˜é‡ï¼Œæœªè¿›è¡ŒåŒæ­¥ä¿æŠ¤
- **å½±å“**: æ•°æ®ç«žäº‰å¯¼è‡´ä¸å¯é¢„æœŸçš„è¡Œä¸ºã€æ•°æ®æŸåæˆ–ç¨‹åºå´©æºƒ
- **æ£€æµ‹æ–¹å¼**:
  - æ£€æµ‹å…±äº«å˜é‡çš„å¹¶å‘è¯»å†™
  - ä½¿ç”¨ `go build -race` å¯ä»¥æ£€æµ‹
- **ç¤ºä¾‹**:

```go
// Bad - æ— ä¿æŠ¤çš„å…±äº«è®¿é—®
var counter int

func increment() {
    counter++  // ç«žæ€æ¡ä»¶
}

// Good - ä½¿ç”¨ sync.Mutex
var counter int
var mu sync.Mutex

func increment() {
    mu.Lock()
    counter++
    mu.Unlock()
}

// Good - ä½¿ç”¨ atomic
var counter int64

func increment() {
    atomic.AddInt64(&counter, 1)
}
```

- **å»ºè®®ä¿®æ”¹**: ä½¿ç”¨ `sync.Mutex`ã€`sync.RWMutex` æˆ– `sync/atomic` ä¿æŠ¤å…±äº«æ•°æ®

---

### [GO-MF004] èµ„æºæ³„æ¼

- **æè¿°**: æ‰“å¼€çš„æ–‡ä»¶ã€ç½‘ç»œè¿žæŽ¥ã€æ•°æ®åº“è¿žæŽ¥ç­‰èµ„æºæœªè¢«æ­£ç¡®å…³é—­
- **å½±å“**: æ–‡ä»¶æè¿°ç¬¦è€—å°½ã€è¿žæŽ¥æ•°è¶…é™
- **æ£€æµ‹æ–¹å¼**:
  - æ£€æµ‹ `os.Open`ã€`net.Dial` ç­‰è¿”å›žçš„èµ„æºæœªå…³é—­
  - æ£€æµ‹ç¼ºçœ `defer close()`
- **ç¤ºä¾‹**:

```go
// Bad - èµ„æºå¯èƒ½æœªå…³é—­
func readFile(path string) ([]byte, error) {
    file, err := os.Open(path)
    if err != nil {
        return nil, err
    }
    // å¦‚æžœåŽç»­è¿”å›žé”™è¯¯ï¼Œfile æœªå…³é—­
    return ioutil.ReadAll(file)
}

// Good
func readFile(path string) ([]byte, error) {
    file, err := os.Open(path)
    if err != nil {
        return nil, err
    }
    defer file.Close()
    return ioutil.ReadAll(file)
}
```

- **å»ºè®®ä¿®æ”¹**: å¯¹æ‰€æœ‰éœ€è¦å…³é—­çš„èµ„æºä½¿ç”¨ `defer` ç¡®ä¿å…³é—­

---

### [GO-MF005] ç©ºæŒ‡é’ˆè§£å¼•ç”¨

- **æè¿°**: åœ¨æœªæ£€æŸ¥ nil çš„æƒ…å†µä¸‹è§£å¼•ç”¨æŒ‡é’ˆ
- **å½±å“**: å¯¼è‡´ panic
- **æ£€æµ‹æ–¹å¼**:
  - æ£€æµ‹æŒ‡é’ˆçš„è§£å¼•ç”¨æ“ä½œæœªè¿›è¡Œ nil æ£€æŸ¥
  - æ£€æµ‹æŽ¥å£ç±»åž‹æ–­è¨€æœªä½¿ç”¨ `ok` æ¨¡å¼
- **ç¤ºä¾‹**:

```go
// Bad - æœªæ£€æŸ¥ nil
func process(data []byte) {
    str := string(data)  // å¦‚æžœ data ä¸º nil å¯èƒ½å‡ºé—®é¢˜
}

// Bad - ç±»åž‹æ–­è¨€æœªæ£€æŸ¥
var x interface{} = "hello"
num := x.(int)  // panic

// Good
func process(data []byte) {
    if data == nil {
        return
    }
    str := string(data)
}

// Good
if num, ok := x.(int); ok {
    // ä½¿ç”¨ num
}
```

- **å»ºè®®ä¿®æ”¹**: è§£å¼•ç”¨å‰æ£€æŸ¥ nilï¼Œç±»åž‹æ–­è¨€ä½¿ç”¨ `ok` æ¨¡å¼

---

## ðŸŸ¡ Should Fix (-2)

### [GO-SF001] å‘½åä¸ç¬¦åˆè§„èŒƒ

- **æè¿°**: å˜é‡ã€å‡½æ•°ã€ç±»åž‹åç§°ä¸ç¬¦åˆ Go å‘½åçº¦å®š
- **å½±å“**: é™ä½Žä»£ç å¯è¯»æ€§ï¼Œä¸Ž Go ç¤¾åŒºè§„èŒƒä¸ä¸€è‡´
- **æ£€æµ‹æ–¹å¼**:
  - å¯¼å‡ºæ ‡è¯†ç¬¦é¦–å­—æ¯åº”å¤§å†™
  - éžå¯¼å‡ºæ ‡è¯†ç¬¦é¦–å­—æ¯åº”å°å†™
  - ä½¿ç”¨é©¼å³°å‘½åï¼Œä¸ä½¿ç”¨ä¸‹åˆ’çº¿
  - åŒ…åå…¨å°å†™ï¼Œæ— ä¸‹åˆ’çº¿æˆ–å¤§å†™
- **ç¤ºä¾‹**:

```go
// Bad - ä¸‹åˆ’çº¿å‘½å
var user_name string

// Bad - åŒ…åä¸è§„èŒƒ
package MyPackage

// Good
var userName string

// Good
package mypackage
```

- **å»ºè®®ä¿®æ”¹**: éµå¾ª Effective Go å’Œ CodeReviewComments ä¸­çš„å‘½åè§„èŒƒ

---

### [GO-SF002] å‡½æ•°è¿‡é•¿

- **æè¿°**: å•ä¸ªå‡½æ•°ä»£ç è¡Œæ•°è¿‡å¤šï¼ˆå»ºè®®è¶…è¿‡ 100 è¡Œï¼‰
- **å½±å“**: é™ä½Žå¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œéš¾ä»¥æµ‹è¯•
- **æ£€æµ‹æ–¹å¼**: ç»Ÿè®¡å‡½æ•°ä½“æœ‰æ•ˆè¡Œæ•°
- **ç¤ºä¾‹**:

```go
// Bad - è¶…è¿‡100è¡Œçš„å‡½æ•°
func processData() {
    // ... 100+ è¡Œä»£ç  ...
}

// Good - æ‹†åˆ†æˆå¤šä¸ªå°å‡½æ•°
func processData() {
    data := loadData()
    validated := validateData(data)
    result := transformData(validated)
    saveResult(result)
}
```

- **å»ºè®®ä¿®æ”¹**: å°†é•¿å‡½æ•°æ‹†åˆ†æˆå¤šä¸ªèŒè´£å•ä¸€çš„å°å‡½æ•°

---

### [GO-SF003] é­”æ³•æ•°å­—

- **æè¿°**: ä»£ç ä¸­å‡ºçŽ°æœªå‘½åçš„æ•°å­—å­—é¢é‡ï¼ˆ0ã€1 é™¤å¤–ï¼‰
- **å½±å“**: é™ä½Žä»£ç å¯è¯»æ€§ï¼Œä¿®æ”¹æ—¶å®¹æ˜“é—æ¼
- **æ£€æµ‹æ–¹å¼**: æ£€æµ‹éž 0/1 çš„æ•°å­—å­—é¢é‡
- **ç¤ºä¾‹**:

```go
// Bad - é­”æ³•æ•°å­—
if size > 1024 {
    // ...
}
time.Sleep(5000)

// Good
const MaxSize = 1024
const RetryDelay = 5 * time.Second

if size > MaxSize {
    // ...
}
time.Sleep(RetryDelay)
```

- **å»ºè®®ä¿®æ”¹**: å®šä¹‰å¸¸é‡æˆ–é…ç½®é¡¹æ›¿ä»£é­”æ³•æ•°å­—

---

### [GO-SF004] ç¼ºå°‘æ³¨é‡Šçš„å¤æ‚é€»è¾‘

- **æè¿°**: å¤æ‚çš„æ¡ä»¶åˆ¤æ–­ã€å¾ªçŽ¯æˆ–ç®—æ³•ç¼ºå°‘è§£é‡Šæ€§æ³¨é‡Š
- **å½±å“**: é™ä½Žä»£ç å¯è¯»æ€§ï¼Œå¢žåŠ ç»´æŠ¤éš¾åº¦
- **æ£€æµ‹æ–¹å¼**:
  - å¤šå±‚åµŒå¥—æ¡ä»¶
  - å¤æ‚çš„æ­£åˆ™è¡¨è¾¾å¼
  - ç®—æ³•æ ¸å¿ƒé€»è¾‘
- **ç¤ºä¾‹**:

```go
// Bad - å¤æ‚é€»è¾‘æ— æ³¨é‡Š
if (a > 10 && b < 20) || (c != "" && d == 0) {
    // ...
}

// Good
// Check if user is eligible for discount:
// - Level > 10 and balance < 20, OR
// - Has special promo code and new customer
if (level > 10 && balance < 20) || (promoCode != "" && isNewCustomer) {
    // ...
}
```

- **å»ºè®®ä¿®æ”¹**: ä¸ºå¤æ‚é€»è¾‘æ·»åŠ è§£é‡Šæ€§æ³¨é‡Š

---

### [GO-SF005] è¿‡åº¦åµŒå¥—

- **æè¿°**: ä»£ç åµŒå¥—å±‚çº§è¿‡æ·±ï¼ˆå»ºè®®è¶…è¿‡ 3 å±‚ï¼‰
- **å½±å“**: é™ä½Žå¯è¯»æ€§ï¼Œå¢žåŠ åœˆå¤æ‚åº¦
- **æ£€æµ‹æ–¹å¼**: ç»Ÿè®¡ä»£ç å—åµŒå¥—å±‚çº§
- **ç¤ºä¾‹**:

```go
// Bad - æ·±å±‚åµŒå¥—
if a {
    if b {
        if c {
            if d {
                // ...
            }
        }
    }
}

// Good - æå‰è¿”å›ž
if !a {
    return
}
if !b {
    return
}
if !c {
    return
}
if d {
    // ...
}
```

- **å»ºè®®ä¿®æ”¹**: ä½¿ç”¨å«å®è¯­å¥ï¼ˆguard clausesï¼‰æˆ–æå–å‡½æ•°å‡å°‘åµŒå¥—

---

## ðŸ”µ Nice to Have (-1)

### [GO-NH001] å¯ä½¿ç”¨ stdlib ç­‰æ•ˆåŠŸèƒ½

- **æè¿°**: é‡å¤å®žçŽ°äº†æ ‡å‡†åº“å·²æœ‰çš„åŠŸèƒ½
- **å½±å“**: å¢žåŠ ç»´æŠ¤è´Ÿæ‹…ï¼Œæ ‡å‡†åº“æ˜¯ç»è¿‡å……åˆ†æµ‹è¯•çš„
- **æ£€æµ‹æ–¹å¼**: æ£€æµ‹è‡ªå®žçŽ°å‡½æ•°ä¸Ž stdlib åŠŸèƒ½é‡å¤
- **ç¤ºä¾‹**:

```go
// Bad - è‡ªå®žçŽ° trim
func trimSpace(s string) string {
    return strings.Trim(s, " ")
}

// Good
func trimSpace(s string) string {
    return strings.TrimSpace(s)
}
```

- **å»ºè®®ä¿®æ”¹**: ä¼˜å…ˆä½¿ç”¨æ ‡å‡†åº“åŠŸèƒ½

---

### [GO-NH002] å˜é‡å£°æ˜Žä½†æœªä½¿ç”¨

- **æè¿°**: å£°æ˜Žäº†å˜é‡ä½†æœªè¯»å–å…¶å€¼
- **å½±å“**: å¯èƒ½æ˜¯ä»£ç å†—ä½™æˆ–é€»è¾‘é”™è¯¯
- **æ£€æµ‹æ–¹å¼**: é™æ€åˆ†æžæ£€æµ‹æœªä½¿ç”¨å˜é‡
- **ç¤ºä¾‹**:

```go
// Bad
func calculate() int {
    x := 10
    y := 20  // æœªä½¿ç”¨
    return x * 2
}

// Good - åˆ é™¤æœªä½¿ç”¨å˜é‡æˆ–ä½¿ç”¨ _ å¿½ç•¥
func calculate() int {
    x := 10
    return x * 2
}
```

- **å»ºè®®ä¿®æ”¹**: åˆ é™¤æœªä½¿ç”¨çš„å˜é‡

---

### [GO-NH003] å¯¼å…¥ä½†æœªä½¿ç”¨

- **æè¿°**: å¯¼å…¥äº†åŒ…ä½†æœªä½¿ç”¨
- **å½±å“**: ä»£ç ä¸å¹²å‡€ï¼Œå½±å“ç¼–è¯‘
- **æ£€æµ‹æ–¹å¼**: `go build` ä¼šæŠ¥é”™
- **ç¤ºä¾‹**:

```go
// Bad
import (
    "fmt"
    "os"  // æœªä½¿ç”¨
)

// Good - åˆ é™¤æœªä½¿ç”¨çš„å¯¼å…¥
import (
    "fmt"
)
```

- **å»ºè®®ä¿®æ”¹**: åˆ é™¤æœªä½¿ç”¨çš„å¯¼å…¥ï¼Œå¯ä»¥ä½¿ç”¨ `goimports` è‡ªåŠ¨å¤„ç†

---

### [GO-NH004] å¯ç®€åŒ–çš„å­—ç¬¦ä¸²æ‹¼æŽ¥

- **æè¿°**: ä½¿ç”¨ `fmt.Sprintf` ä½†å®žé™…åªéœ€è¦ç®€å•æ‹¼æŽ¥
- **å½±å“**: æ€§èƒ½ç¨å·®ï¼Œä»£ç å¯è¯»æ€§ä¸å¦‚ç›´æŽ¥æ‹¼æŽ¥
- **æ£€æµ‹æ–¹å¼**: `fmt.Sprintf` ä¸­åªæœ‰å­—ç¬¦ä¸²æ‹¼æŽ¥å’Œç®€å•æ ¼å¼
- **ç¤ºä¾‹**:

```go
// Bad
s := fmt.Sprintf("%s%s", a, b)

// Good
s := a + b

// Or with builder for many concatenations
var b strings.Builder
b.WriteString(a)
b.WriteString(b)
s := b.String()
```

- **å»ºè®®ä¿®æ”¹**: ç®€å•æ‹¼æŽ¥ä½¿ç”¨ `+`ï¼Œå¤§é‡æ‹¼æŽ¥ä½¿ç”¨ `strings.Builder`

---

## å‚è€ƒèµ„æº

- [Effective Go - Comments](https://go.dev/doc/effective_go#comments)
- [Code Review Comments](https://github.com/golang/go/wiki/CodeReviewComments)
- [Go Code Review Checklist](https://github.com/golang/go/wiki/CodeReviewChecklist)
